---
layout: '../../layouts/MarkdownPost.astro'
title: '[TCP/IP] 数据链路层协议: 以太网帧协议格式、ARP协议...'
pubDate: 2024-11-29
description: ''
author: '哈米d1ch'
cover:
    url: 'https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/202411291357452.webp'
    square: 'https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/202411291357452.webp'
    alt: 'cover'
tags: ["Linux网络", "TCP-IP", "数据链路层", "协议", "约字 -- 阅读时间≈分钟"]
theme: 'light'
featured: false
---

`TCP/IP`协议栈 四层模型, 应用层、传输层、网络层 以及**数据链路层**, 分别在网络通信中担任不同的角色

关于上面三层

1. 应用层协议

    应用层协议, 通常是用户最需要关注的内容, 因为它关系着用户数据实际的格式, 决定了对端能否正确的解析出真实有效的数据, 以及数据的加密等内容

    常用的有`HTTP`、`HTTPS`等

2. 传输层协议

    传输层协议的使用, 更多与通信的场景有关, 数据传输是否需要保障可靠性, 通信是否需要建立连接等等

    常用的有`UDP`、`TCP`协议等

3. 网络层协议

    网络层协议, 主要作用是要实现网络的构建, 并且为数据提供跨网络传输的能力

    常用的有`IP`协议等

局域网内的设备是可以直接通信的, 不用经过路由, 这是数据链路层能够实现的功能

数据链路层 的协议, 就是**实际用于同一局域网内两节点之间传输数据的**

# 以太网帧协议

网络硬件设备(网卡), 都有自己的物理地址 被称为`MAC`地址, `MAC`地址是硬件出场时就设定好的, 通常是全球唯一的(实际上并总是需要, 一般情况下只需要在所在网络内保持唯一就可以了)

**`MAC`地址的长度为48位, 一般用16进制加上`:`表示**, 比如:`d8:80:83:21:02:95`

**`MAC`地址是用来确定局域网内唯一的网络设备的**

此时, 可能会出现一个疑问: **`IP`协议已经能让主机在网络中唯一了, 为什么还要用`MAC`地址确定局域网内的唯一设备呢?**

因为, 数据从主机A发送到主机B的整个传输过程中, `IP`的作用除了能够确定网络中的唯一主机之外, **最主要的作用其实是路由**

通过`IP`的网络号, 可以快速排除非目标网络, 进而实现数据的在不同网络中的快速路由

直到**数据报文发送到目标网络之后, 并不会只通过`IP`地址确定局域网内的主机, 而是会通过`IP`查询局域网内对应设备的`MAC`地址, 获取到`MAC`地址之后, 才会向此`MAC`地址的设备 发送数据**

而, 数据链路层协议, 就是通过`MAC`地址, 实现同一局域网内设备之间的通信

**以太网** 是数据链路层和物理层中, 运用最广泛的一种局域网技术标准

有线网络数据链路层协议即为: **以太网帧协议**

## 以太网帧格式

以太网帧格式比较简单:

![|lwide](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/202411291653587.webp)

> 实际, 前边(左边)还存在两个字段**7字节的前导码**和**1字节的帧开始界定符**
>
> 这两个字段内容是固定的, 用户不用考虑

1. `6`字节 目的`MAC`地址

    即, 目标局域网内 目标主机的`MAC`地址

2. `6`字节 源`MAC`地址

    即, 发送端主机的`MAC`地址

3. `2`字节 类型

    此字段用于区分以太网帧的数据类型

    以太网帧数据是存在不同类型的: `IP` `ARP` `RARP`

    `0800`表示 `IP`数据类型

    `0806`表示 `ARP`数据类型

    `8035`表示 `RARP`数据类型

4. `46~1500`字节 数据

    这里就是上层协议交付下来的数据 或 `ARP` `RARP`数据

    具体要根据上一个字段 判断

5. `4`字节 `CRC`

    即, 数据校验码

以太网帧 在数据链路层传输时, 主要依靠`MAC`地址定位唯一的设备, 所以 以太网帧又被称为`MAC`帧

`MAC`帧的非数据字段是固定的: `6Byte DestMAC + 6Byte SourceMAC + 2Byte DataType + 4Byte CRC`

这可以很好的解决`MAC`帧的封装和解包的问题

## 数据在局域网内的传输**

同一局域网内的主机 是可以直接通信的, 因为局域网内的数据通常以以太网帧的形式流通

以太网帧确定唯一主机是由`MAC`地址确定的

当以太网帧填充好源`MAC`地址和目的`MAC`地址 和 数据 之后, 将数据发送到局域网中, **局域网中的设备就能根据以太网帧中的目的`MAC`地址接收数据**

假设存在8台主机, 通过一根总线连接成一个局域网

![|lwide](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/202411291956163.webp)

此时`MAC1`要向`MAC7`发任意数据, 则`MAC1`会填充以太网帧:

![|huge](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/202411292001089.webp)

`MAC1`主机 将封装完成的`MAC`帧发送到总线上, 就相当于发送到了局域网中

那么`MAC7`设备如何知道这数据是发给它的呢?

`MAC7`要想知道这个`MAC`帧是给它发送的, `MAC7`就要接收这个`MAC`帧 然后读取其中的目的`MAC`地址, 然后进行对比 才能确认. `MAC7`也确实是这样接收到数据的

即, **向局域网中发送的数据, 只有在目标设备接收到之后, 才能确认数据的目标是自己**

这也就是说, **向局域网中发送的数据, 要想正确地抵达目的地, 局域网中的所有设备都要接收并读取一次`MAC`帧的目的`MAC`地址, 如果`MAC`地址对比正确, 就解包并向上层交付, 否则 就丢弃**

构建局域网的这根总线, 连接着局域网中的所有主机

总线中有数据在传输时, 局域网中的所有主机都可以看见并接收数据, 而局域网中的主机各自又是独立的

所有主机共用一根总线进行数据传输, 就一定会出现一种现象: **`MAC1`向总线中发数据的时, 已经有其他设备向总线中发送了数据**

这种 数据帧在总线中传输时发生了碰撞 的现象, 叫做**数据碰撞**, 而会发生碰撞现象的局域网, 就被称为**碰撞域**

发生数据碰撞, 数据在总线中的传输会受到影响, 导致数据传输混乱

**为了降低数据碰撞发生的概率, 碰撞域就应该越小越好, 即 局域网中的主机越少越好**

而, 交换机最重要的功能之一就是划分碰撞域, 交换机的每一个端口都可以划分为一个碰撞域, 可以有效的减少数据碰撞的发生

---

在局域网内, 数据是以`MAC`帧的形式传输的, 确定唯一主机的依据是`MAC`地址

但是有一个问题: **发送方如何知道接收方的`MAC`地址?**

`MAC`地址是网络设备的物理地址, 而网络通信双方绝大多数情况都不可能是近距离通信, 发送方如何知道接收方的`MAC`地址?

